<!DOCTYPE HTML>
<html lang="ko">
<head>
  	<title>Chat Client</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="http://mimo.co.kr/mobile/som/css/base.css">
    <link rel="stylesheet" type="text/css" href="http://mimo.co.kr/plugins/fontium/css/fontium.css"> 
    
    <style>
		input{
			height:30px;
			-webkit-box-sizing:border-box;
			box-sizing:border-box;
			vertical-align:top;
			outline:0;
		}
		#content{
			background-color: #fafafa;
			height: 400px;
			overflow-y:scroll;
			-webkit-overflow-scrolling: touch;
			overflow-scrolling: touch;
			padding:10px;
			box-sizing:border-box;
		}
	</style>
  	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script> 	
	<script src="/socket.io/socket.io.js"></script>   

	<script type="text/javascript">
		var getNowTime = function ()
		{			
			var day=new Date(); 
			var y=day.getYear(); 
			if(y<2000)y=y+1900; 
			var mon=day.getMonth(); 
			var date=day.getDate(); 
			var h = day.getHours();
			var m = day.getMinutes();
			var s = day.getSeconds();
			return y.toString().substring(2,4) + '/' + mon + '/' + date +' ' + h + ':' + m + ':' + s;
		}
	
		window.onload = function(){
	
			//var room = prompt( '방 이름을 입력하세요.', '<%= room %>' );   
			var room = '<%= room %>';
			var userId = '<%= id %>';
			var name = '<%= name %>';
			
			var socket = io.connect(); //소켓서버 연결
			socket.emit( 'join', {
				id: userId,
				name: name,
				room: room 
			});
			socket.on( 'message', function(data){
				var output = '<p>[' + data.id +'] ' + data.message + ' (' + data.date + ')</p>';
				$( output ).appendTo('#content');
				$('#content').scrollTop($('#content')[0].scrollHeight);	
			});	
			
			$('#button').click(function(){
				var uid = $('#uid').val();
				var msg = $('#msg').val();
				
				//서버측 'message' 이벤트를 호출한다. 이때 msg 전달
				var prtDate = getNowTime();
				socket.emit('message', {
					id : uid,
					message : msg,
					date : prtDate
				}); //서버측 'message' 이벤트를 호출한다. 이때 msg 전달
				
				var msg = $('#msg').val(''); //메세지 내용 초기화
			});
			
			$('#button2').click(function(){
				//window.close();
				location.href="http://mimo.co.kr";
			});
		};
		
		$(document).on("keydown", "#msg", function(event) {
              
               if( window.netscape )
               {                                       
                    // FF         
                    if(event.which == '13') {
                         $("#button").trigger("click");
                         event.preventDefault();
                    }
               }
               else
               {
                    // IE
                    if(event.keyCode == '13') {
                         $("#button").trigger("click");
                         event.returnValue=false;
                    }
               }                   
          });
         
	</script>
</head>
<body>
<div class="wrapper">	

	<div class="header"><div class="back-icon"></div><h1><%= room %></h1></div>

	<div id="content"></div>

	<div style="padding:10px 0 0 5px;">
    <input type="hidden" id="uid" value="<%=name%>" />
    <table width="100%" border="0">
    	<tr>
        	<td><input type="text" id="msg" autofocus style="width:100%" /></td>
            <td width="57"><input type="button" id="button" value="메세지" class="button-sm" />
            <!--<input type="button" id="button2" value="퇴장" class="button-sm" />--></td>
        </tr>
    </table>
    </div>
    
</div>

</body>
</html>